<div class="messages">
  <div class="error-message" *ngIf="errorMessage">{{errorMessage}}</div>
</div>

<table class="table-horizontal-layout table-in-tab history-table">
  <thead>
  	<tr>
      <th colspan="2"></th>
      <th>{{ 'workflow step' | translate }}</th>
      <th>{{ 'totalprocessed' | translate }}</th>
      <th>{{ 'totaldataset' | translate }}</th>
      <th>{{ 'status' | translate }}</th>
      <th class="centered">{{ 'startdate' | translate }}</th>
      <th class="centered">{{ 'enddate' | translate }}</th>
      <th colspan="2"></th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let ex of allExecutions">
      <td *ngIf="ex.createdDate" colspan="9" class="workflow-head">
        <div class="head-whitespace"></div>
        <div class="head-text" (dblclick)="copyInformation('execution', ex.id, ex.ecloudDatasetId);">
          <span class="tooltip" attr.data-tooltip="{{ 'doubleclicktocopy' | translate }}">{{ 'workflowcreated' | translate }} {{ex.createdDate | date:'dd/MM/yyyy HH:mm' }}</span>
        </div>
      </td>  
      <td *ngIf="!ex.createdDate && ex.executionProgress" class="centered"><span class="svg-icon-{{ex.pluginType}}"></span></td>
      <td *ngIf="!ex.createdDate && ex.executionProgress" class="errorindicator"><span class="error" *ngIf="ex.executionProgress.errors !== 0"></span></td>
      <td *ngIf="!ex.createdDate && ex.executionProgress" class="nowrap uppercase" (dblclick)="copyInformation('plugin', ex.externalTaskId, ex.id);">
        <span class="tooltip" attr.data-tooltip="{{ 'doubleclicktocopy' | translate }}">{{ex.pluginType | renameWorkflow}} {{ex.workflowCreated}}</span>
      </td>
      <td *ngIf="!ex.createdDate && ex.executionProgress"class="nowrap">{{ex.executionProgress.processedRecords - ex.executionProgress.errors}} <span class="errors" *ngIf="ex.executionProgress.errors > 0">({{ex.executionProgress.errors}})</span></td>
      <td *ngIf="!ex.createdDate && ex.executionProgress" class="nowrap uppercase">
        {{ex.executionProgress.expectedRecords >= 0 ? ex.executionProgress.expectedRecords : ('unknown' | translate)}}
      </td>
      <td *ngIf="!ex.createdDate && ex.executionProgress" class="nowrap">{{ex.pluginStatus}}</td>
      <td *ngIf="!ex.createdDate && ex.executionProgress" class="centered"><span class="date">{{ex.startedDate | date:'dd/MM/yyyy'}}</span> <span class="datedivider">-</span> <span class="time">{{ex.startedDate | date:'HH:mm'}}</span></td>
      <td *ngIf="!ex.createdDate && ex.executionProgress" class="centered"><span class="date">{{ex.finishedDate | date:'dd/MM/yyyy'}}</span> <span class="datedivider">-</span> <span class="time">{{ex.finishedDate | date:'HH:mm'}}</span></td>
      <td *ngIf="!ex.createdDate && ex.executionProgress" class="buttonplaceholder nowrap">
        <a *ngIf="ex.hasReport" class="table-btn svg-icon-report" (click)="openReport(ex.externalTaskId, ex.topologyName)">         
          {{ 'report' | translate }}
         </a>
      </td>        
    </tr>
  </tbody>
  <tfoot>
    <tr class="loadmore">
      <td colspan="10">
        <a class="load-more-btn" (click)="loadNextPage()" *ngIf="hasMore">{{ 'loadmore' | translate }}</a>
      </td>
    </tr>
  </tfoot>
</table>
<div #starttab></div>

<app-report [report]="report" (closed)="closeReport()"></app-report>
