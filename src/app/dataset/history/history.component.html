<ul class="filter" *ngIf="!inCollapsablePanel" (clickOutside)="onClickedOutside($event)">
  <li class="dropdown">
    <a (click)="toggleFilterByWorkflow()">{{ 'workflow' | translate }}<span *ngIf=selectedFilterWorkflow>: {{selectedFilterWorkflow}}</span></a>
    <ul *ngIf="filterWorkflow">
      <li><a (click)="selectWorkflow()">{{ 'allworkflows' | translate }}</a></li>
      <li *ngFor="let w of allWorkflows;"><a (click)="selectWorkflow(w)">{{w}}</a></li>
    </ul>
  </li>  
</ul>

<div class="messages">
  <div class="error-message" *ngIf="errorMessage"><i class="fa fa-times"></i>{{errorMessage}}</div>
  <div class="success-message" *ngIf="successMessage">{{successMessage}}</div>
</div>

<table class="table-horizontal-layout history-table" *ngIf="datasetData">
  <thead>
  	<tr>
      <th colspan="2"></th>
      <th>{{ 'workflow' | translate }}</th>
      <th>{{ 'totalprocessed' | translate }}</th>
      <th>{{ 'totaldataset' | translate }}</th>
      <th>{{ 'status' | translate }}</th>
      <th class="centered">{{ 'startdate' | translate }}</th>
      <th class="centered">{{ 'enddate' | translate }}</th>
      <th colspan="2"></th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let ex of allExecutions; let i = index">
      <td class="centered"><span class="svg-icon-{{ex.workflowName}}"></span></td>
      <td class="errorindicator"><span class="error" *ngIf="ex.metisPlugins[currentPlugin].executionProgress.errors !== 0"></span></td>
      <td class="nowrap">{{ex.workflowName}}</td>
      <td class="nowrap">{{ex.metisPlugins[currentPlugin].executionProgress.processedRecords}}</td>
      <td class="nowrap">{{ex.metisPlugins[currentPlugin].executionProgress.expectedRecords}}</td>
      <td class="nowrap">{{ex.workflowStatus}}</td>
      <td class="centered"><span class="date">{{ex.startedDate | date:'dd/MM/yyyy'}}</span> <span class="datedivider">-</span> <span class="time">{{ex.startedDate | date:'HH:mm'}}</span></td>
      <td class="centered"><span class="date">{{ex.finishedDate | date:'dd/MM/yyyy'}}</span> <span class="datedivider">-</span> <span class="time">{{ex.finishedDate | date:'HH:mm'}}</span></td>
      <td class="buttonplaceholder nowrap">
        <a *ngIf="ex.hasReport" class="table-btn svg-icon-report" (click)="openReport(ex.metisPlugins[currentPlugin].externalTaskId, ex.metisPlugins[currentPlugin].topologyName)">         
          {{ 'report' | translate }}
         </a>
      </td>
      <td class="buttonplaceholder nowrap"><a class="table-btn" *ngIf="!workflowRunning" (click)="triggerWorkflow(ex.workflowName)">{{ 'restart' | translate }}</a></td>
    </tr>
    <tr class="loadmore loadmore-history" *ngIf="inCollapsablePanel">
      <td colspan="10">
        <a class="load-more-btn" routerLink="/dataset/log/{{datasetData ? datasetData.datasetId : ''}}" (click)="scroll(starttab)">{{ 'fullhistory' | translate }}</a>
      </td>
    </tr>
    <tr class="loadmore" *ngIf="!inCollapsablePanel">
      <td colspan="10">
        <a class="load-more-btn" (click)="loadNextPage()" *ngIf="nextPage > 0">{{ 'loadmore' | translate }}</a>
      </td>
    </tr>
  </tbody>
</table>
<div #starttab></div>

<app-report *ngIf="report"></app-report>
