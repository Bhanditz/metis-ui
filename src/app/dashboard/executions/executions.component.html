<div class="messages">
  <div class="error-message" *ngIf="errorMessage">{{errorMessage}}</div>
  <div class="success-message" *ngIf="successMessage">{{successMessage}}</div>
</div>

<div class="all-executions">
  <h3>{{ 'allexecutions' | translate }}</h3>

  <ul class="filter" (clickOutside)="onClickedOutside()">
    <li class="dropdown">
      <a (click)="toggleFilterByWorkflow()">{{ 'workflow' | translate }}<span *ngIf=selectedFilterWorkflow>: {{selectedFilterWorkflow}}</span></a>
      <div *ngIf="filterWorkflow" class="dropdown-wrapper">
        <ul>
          <li><a (click)="selectWorkflow()">{{ 'allworkflows' | translate }}</a></li>
          <li *ngFor="let w of allWorkflows;"><a (click)="selectWorkflow(w)">{{w}}</a></li>
        </ul>
      </div>
    </li>  
  </ul>

  <table class="table-horizontal-layout executions-table">
    <thead>
    	<tr>
        <th colspan="4"></th>
        <th>{{ 'workflow' | translate }}</th>
        <th>{{ 'totalprocessed' | translate }}</th>
        <th>{{ 'totaldataset' | translate }}</th>
        <th class="centered">{{ 'startdate' | translate }}</th>
        <th class="centered">{{ 'enddate' | translate }}</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let execution of ongoingExecutionsOutput;">
        <td class="errorindicator"><span class="error" *ngIf="execution.metisPlugins[currentPlugin].executionProgress.errors !== 0"></span></td>
        <td class="nowrap">{{execution.datasetId}}</td>
        <td><a [routerLink]="['/dataset', 'edit', execution.datasetId]">{{execution.datasetName}}</a></td>
        <td class="iconplaceholder"><span class="svg-icon-{{execution.workflowName}}"></span></td>
        <td class="nowrap"><span class="ellipsis">{{execution.workflowName}}</span></td>
        <td class="nowrap">{{execution.metisPlugins[currentPlugin].executionProgress.processedRecords}}</td>
        <td class="nowrap uppercase">
          {{execution.metisPlugins[currentPlugin].executionProgress.expectedRecords >= 0 ? execution.metisPlugins[currentPlugin].executionProgress.expectedRecords : ('unknown' | translate)}}
        </td>
        <td class="centered">
          <span class="date">{{execution.createdDate | date:'dd/MM/yyyy'}}</span> 
          <span class="datedivider">-</span> 
          <span class="time">{{execution.createdDate | date:'HH:mm'}}</span>
        </td>
        <td class="centered nowrap">
          <div class="progress">
            <span>
              {{execution.metisPlugins[currentPlugin].executionProgress.progressPercentage >= 0 ? execution.metisPlugins[currentPlugin].executionProgress.progressPercentage : ('unknown' | translate)}}%
            </span>
            <div class="progressbar">
              <div class="progressbar-done" [style.width.%]="execution.metisPlugins[currentPlugin].executionProgress.progressPercentage >= 0 ? execution.metisPlugins[currentPlugin].executionProgress.progressPercentage : 0"></div>
            </div>
          </div>
          <nav>
            <ul>
              <li *ngIf="!execution.cancelling"><a class="cancel-btn svg-icon-cancel tooltip" attr.data-tooltip="{{ 'cancel' | translate }}" (click)="cancelWorkflow(execution.id)"></a></li>
              <li><a [routerLink]="['/dataset', 'log', execution.datasetId]" class="log-btn svg-icon-history tooltip" attr.data-tooltip="{{ 'history' | translate }}"></a></li>
            </ul>
          </nav>
        </td>    
      </tr>
      <tr *ngFor="let execution of allExecutions;">
        <td class="errorindicator"><span class="error" *ngIf="execution.metisPlugins[currentPlugin].executionProgress.errors !== 0"></span></td>
        <td class="nowrap">{{execution.datasetId}}</td>
        <td><a [routerLink]="['/dataset', 'edit', execution.datasetId]">{{execution.datasetName}}</a></td>
        <td class="iconplaceholder"><span class="svg-icon-{{execution.workflowName}}"></span></td>
        <td class="nowrap"><span class="ellipsis">{{execution.workflowName}}</span></td>
        <td class="nowrap">{{execution.metisPlugins[currentPlugin].executionProgress.processedRecords}}</td>
        <td class="nowrap uppercase">
          {{execution.metisPlugins[currentPlugin].executionProgress.expectedRecords >= 0 ? execution.metisPlugins[currentPlugin].executionProgress.expectedRecords : ('unknown' | translate)}}
        </td>
        <td class="centered">
          <span class="date">{{execution.createdDate | date:'dd/MM/yyyy'}}</span> 
          <span class="datedivider">-</span> 
          <span class="time">{{execution.createdDate | date:'HH:mm'}}</span>
        </td>
        <td class="centered">
          <span class="date">{{execution.finishedDate | date:'dd/MM/yyyy'}}</span> 
          <span class="datedivider">-</span> 
          <span class="time">{{execution.finishedDate | date:'HH:mm'}}</span>
        </td>  
      </tr>
      <tr class="loadmore">
        <td colspan="9">
          <a class="load-more-btn" (click)="loadNextPage()" *ngIf="nextPage > 0">{{ 'loadmore' | translate }}</a>
        </td>
      </tr>
    </tbody>
  </table>
</div>
